<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upgrading of Nagios &mdash; HiSPARC servers 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/hisparc_style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="HiSPARC servers 0.1 documentation" href="index.html" />
    <link rel="next" title="Upgrading of TYPO3" href="typo3.html" />
    <link rel="prev" title="Installation of Neckar" href="neckar.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="typo3.html" title="Upgrading of TYPO3"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="neckar.html" title="Installation of Neckar"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">HiSPARC servers 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="upgrading-of-nagios">
<h1>Upgrading of Nagios<a class="headerlink" href="#upgrading-of-nagios" title="Permalink to this headline">¶</a></h1>
<p>This describes how to update <a class="reference external" href="http://www.nagios.org">Nagios Core</a>. This guide is about applying this update on tietar (<a class="reference internal" href="tietar.html"><em>Installation of Tietar</em></a>).</p>
<div class="section" id="current-versions">
<h2>Current versions<a class="headerlink" href="#current-versions" title="Permalink to this headline">¶</a></h2>
<p>Check current version of the OS, Apache and PHP.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>cat /etc/redhat-release
CentOS release 5.7 <span class="o">(</span>Final<span class="o">)</span>
<span class="nv">$ </span>httpd -v
Server version: Apache/2.2.24
<span class="nv">$ </span>php -v
PHP 5.1.6
<span class="nv">$ </span>yum list installed | grep php
php.i386                  5.1.6-27.el5_5.3      installed
php-cli.i386              5.1.6-27.el5_5.3      installed
php-common.i386           5.1.6-27.el5_5.3      installed
</pre></div>
</div>
<p>Check the current version of Nagios and its packages.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>yum list installed | grep nagios
nagios.i386               3.5.0-1.el5           installed
nagios-nsca.i386          2.7.2-4.el5.rf        installed
nagios-nsca-client.i386   2.7.2-4.el5.rf        installed
nagios-plugins.i386       1.4.16-1.el5.rf       installed
nagios-plugins-nrpe.i386  2.14-1.el5.rf         installed
</pre></div>
</div>
<p>Check TYPO3 version at <a class="reference external" href="http://www.hisparc.nl/typo3/">http://www.hisparc.nl/typo3/</a> -&gt; 4.5</p>
<p>Then check the requirements for the new TYPO3 version to see if an update of any package is required.</p>
</div>
<div class="section" id="upgrade-from-3-2-3-to-3-5-0">
<h2>Upgrade from 3.2.3 to 3.5.0<a class="headerlink" href="#upgrade-from-3-2-3-to-3-5-0" title="Permalink to this headline">¶</a></h2>
<p>Nagios can be updated to 3.5.0 on CentOS, from the rpm/yum <a class="reference external" href="http://pkgs.org/centos-5-rhel-5/centalt-i386/nagios-3.5.0-1.el5.i386.rpm.html">CentALT</a> repo.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span>wget http://centos.alt.ru/repository/centos/5/i386/nagios-3.5.0-1.el5.i386.rpm
<span class="nv">$ </span>rpm -i --test nagios-3.5.0-1.el5.i386.rpm
warning: nagios-3.5.0-1.el5.i386.rpm: Header V3 DSA signature: NOKEY, key ID e9bc4ae1
    file /etc/httpd/conf.d/nagios.conf from install of nagios-3.5.0-1.el5.i386 conflicts with file from package nagios-3.2.3-3.el5.rf.i386
    file /etc/nagios/cgi.cfg from install of nagios-3.5.0-1.el5.i386 conflicts with file from package nagios-3.2.3-3.el5.rf.i386
    file /etc/nagios/nagios.cfg from install of nagios-3.5.0-1.el5.i386 conflicts with file from package nagios-3.2.3-3.el5.rf.i386
    file /etc/nagios/objects/commands.cfg from install of nagios-3.5.0-1.el5.i386 conflicts with file from package nagios-3.2.3-3.el5.rf.i386
    file /etc/nagios/objects/timeperiods.cfg from install of nagios-3.5.0-1.el5.i386 conflicts with file from package nagios-3.2.3-3.el5.rf.i386
    file /etc/rc.d/init.d/nagios from install of nagios-3.5.0-1.el5.i386 conflicts with file from package nagios-3.2.3-3.el5.rf.i386
    file /usr/bin/nagiostats from install of nagios-3.5.0-1.el5.i386 conflicts with file from package nagios-3.2.3-3.el5.rf.i386
</pre></div>
</div>
<p>Check the current installed versions and available updates.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>yum list all | grep nagios
nagios.i386                 3.2.3-3.el5.rf              installed
nagios.i386                 3.5.0-1.el5                 CentALT
nagios-devel.i386           3.5.0-1.el5                 CentALT
nagios-plugins.i386         1.4.15-2.el5.rf             installed
nagios-plugins.i386         1.4.16-1.el5.rf             rpmforge
nagios-plugins-nrpe.i386    2.12-1.el5.rf               installed
nagios-plugins-nrpe.i386    2.14-1.el5.rf               rpmforge
nagios-nsca.i386            2.7.2-2.el5.rf              installed
nagios-nsca.i386            2.7.2-4.el5.rf              rpmforge
nagios-nsca-client.i386     2.7.2-2.el5.rf              installed
nagios-nsca-client.i386     2.7.2-4.el5.rf              rpmforge
</pre></div>
</div>
<div class="section" id="install-update">
<h3>Install update<a class="headerlink" href="#install-update" title="Permalink to this headline">¶</a></h3>
<p>Stop Nagios, NSCA and Apache.
(Nagios was running in a screen, not yet as service, so stop it there.)</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>screen -r <span class="o">[</span>..<span class="o">]</span>
^c
<span class="nv">$ </span><span class="nb">exit</span>
<span class="nv">$ </span>sudo /sbin/service nsca stop
<span class="nv">$ </span>sudo /sbin/service httpd stop

<span class="nv">$ </span>yum update nagios nagios-plugins nagios-plugins-nrpe nagios-nsca nagios-nsca-client
&gt; y
Updating : nagios
 warning: /etc/httpd/conf.d/nagios.conf created as /etc/httpd/conf.d/nagios.conf.rpmnew
 warning: /etc/nagios/cgi.cfg created as /etc/nagios/cgi.cfg.rpmnew
 warning: /etc/nagios/nagios.cfg created as /etc/nagios/nagios.cfg.rpmnew
 warning: /etc/nagios/objects/commands.cfg created as /etc/nagios/objects/commands.cfg.rpmnew
 warning: /etc/rc.d/init.d/nagios saved as /etc/rc.d/init.d/nagios.rpmsave
Updated:
 nagios.i386 0:3.5.0-1.el5
 nagios-plugins.i386 0:1.4.16-1.el5.rf
 nagios-plugins-nrpe.i386 0:2.14-1.el5.rf
 nagios-nsca.i386 0:2.7.2-4.el5.rf
 nagios-nsca-client.i386 0:2.7.2-4.el5.rf
</pre></div>
</div>
</div>
<div class="section" id="update-config-files">
<h3>Update config files<a class="headerlink" href="#update-config-files" title="Permalink to this headline">¶</a></h3>
<p>Using the *.rpmnew files as guides.</p>
<p>/etc/httpd/conf.d/nagios.conf:</p>
<div class="highlight-python"><pre>- /usr/share/nagios
+ /usr/share/nagios/html
- /usr/lib/nagios/cgi/
+ /usr/lib/nagios/cgi-bin/</pre>
</div>
<p>/etc/nagios/cgi.cfg:</p>
<div class="highlight-python"><pre>- physical_html_path=/usr/share/nagios/
+ physical_html_path=/usr/share/nagios/html
+ result_limit=0</pre>
</div>
<p>/etc/nagios/nagios.cfg:</p>
<div class="highlight-python"><pre>- log_file=/var/nagios/nagios.log
+ log_file=/var/log/nagios/nagios.log
- object_cache_file=/var/nagios/objects.cache
+ object_cache_file=/var/log/nagios/objects.cache
- precached_object_file=/var/nagios/objects.precache
+ precached_object_file=/var/log/nagios/objects.precache

- resource_file=/etc/nagios/resource.cfg
+ resource_file=/etc/nagios/private/resource.cfg

- status_file=/var/nagios/status.dat
+ status_file=/var/log/nagios/status.dat

? command_file=/var/spool/nagios/cmd/nagios.cmd

- lock_file=/var/run/nagios.pid
+ lock_file=/tmp/nagios.pid

- temp_file=/var/nagios/nagios.tmp
+ temp_file=/var/log/nagios/nagios.tmp

? log_archive_path=/var/log/nagios/archives

- state_retention_file=/var/nagios/retention.dat
+ state_retention_file=/var/log/nagios/retention.dat
+ service_check_timeout_state=c

- p1_file=/usr/bin/p1.pl
+ p1_file=/usr/sbin/p1.pl

- admin_email=davidf@nikhef.nl
- admin_pager=davidf@nikhef.nl
+ admin_email=adelaat@nikhef.nl
+ admin_pager=adelaat@nikhef.nl</pre>
</div>
<p>/etc/nagios/objects/commands.cfg:</p>
<div class="highlight-python"><pre>- /var/nagios/host-perfdata.out
- /var/nagios/service-perfdata.out
+ /var/log/nagios/host-perfdata.out
+ /var/log/nagios/service-perfdata.out</pre>
</div>
<p>/etc/nagios/nsca.cfg:</p>
<div class="highlight-python"><pre>- command_file=/var/nagios/rw/nagios.cmd
+ command_file=/var/spool/nagios/cmd/nagios.cmd
- alternate_dump_file=/var/nagios/rw/nsca.dump
+ alternate_dump_file=/var/log/nagios/rw/nsca.dump</pre>
</div>
</div>
<div class="section" id="verify-config">
<h3>Verify config<a class="headerlink" href="#verify-config" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>nagios -v /etc/nagios/nagios.cfg
</pre></div>
</div>
</div>
<div class="section" id="fix-nagios-daemon">
<h3>Fix Nagios Daemon<a class="headerlink" href="#fix-nagios-daemon" title="Permalink to this headline">¶</a></h3>
<p>Before the update Nagios gave these errors when trying to start as service:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>service nagios start
log:
<span class="o">[</span>1365710071<span class="o">]</span> Failed to obtain lock on file /var/run/nagios.pid: Permission denied
<span class="o">[</span>1365710071<span class="o">]</span> Bailing out due to errors encountered <span class="k">while </span>attempting to daemonize... <span class="o">(</span><span class="nv">PID</span><span class="o">=</span>15845<span class="o">)</span>
</pre></div>
</div>
<p>From: <a class="reference external" href="http://h3x.no/2010/06/30/failed-to-obtain-lock-on-file-varrunnagios-pid-permission-denied">Failed to obtain lock on file /var/run/nagios.pid</a></p>
<p>Changing the value of <tt class="docutils literal"><span class="pre">lock_file</span></tt> in <tt class="docutils literal"><span class="pre">/etc/nagios/nagios.cfg</span></tt> from <tt class="docutils literal"><span class="pre">/var/run/nagios.pid</span></tt> to <tt class="docutils literal"><span class="pre">/tmp/nagios.pid</span></tt> allowed the PID to be written and the init script to succeed.</p>
<p>Change lock_file location to a place with read+write permissions.</p>
</div>
<div class="section" id="start-services">
<h3>Start services<a class="headerlink" href="#start-services" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>sudo /sbin/service httpd start
<span class="nv">$ </span>sudo /sbin/service nagios start
<span class="nv">$ </span>sudo /sbin/service nsca start
</pre></div>
</div>
</div>
<div class="section" id="upgrade-apache-to-latest-2-2-x">
<h3>Upgrade Apache to latest 2.2.x<a class="headerlink" href="#upgrade-apache-to-latest-2-2-x" title="Permalink to this headline">¶</a></h3>
<p>The latest Apache is in the CentALT repository</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>yum list httpd
Installed Packages
httpd.i386                  2.2.3-53.el5.centos.3       installed
Available Packages
httpd.i386                  2.2.24-1.el5                CentALT
</pre></div>
</div>
<p>Stop services</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>sudo /sbin/service httpd stop
<span class="nv">$ </span>sudo /sbin/service nagios stop
<span class="nv">$ </span>sudo /sbin/service nsca stop
</pre></div>
</div>
<p>Update Apache</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>yum update httpd
Dependencies <span class="nv">Resolved</span>

<span class="o">======================================================================</span>
 Package                 Arch    Version          Repository     <span class="nv">Size</span>
<span class="o">======================================================================</span>
Updating:
 httpd                   i386    2.2.24-1.el5     CentALT       1.3 M
Installing <span class="k">for </span>dependencies:
 apr-util-ldap           i386    1.4.1-1.el5      CentALT        14 k
 httpd-tools             i386    2.2.24-1.el5     CentALT        68 k
Updating <span class="k">for </span>dependencies:
 apr-util                i386    1.4.1-1.el5      CentALT        82 k

Transaction <span class="nv">Summary</span>
<span class="o">======================================================================</span>
Install       2 Package<span class="o">(</span>s<span class="o">)</span>
Upgrade       2 Package<span class="o">(</span>s<span class="o">)</span>

&gt; y

warning: /etc/httpd/conf/httpd.conf created as /etc/httpd/conf/httpd.conf.rpmnew

Dependency Installed:
 apr-util-ldap.i386 0:1.4.1-1.el5
 httpd-tools.i386 0:2.2.24-1.el5

Updated:
  httpd.i386 0:2.2.24-1.el5

Dependency Updated:
  apr-util.i386 0:1.4.1-1.el5
</pre></div>
</div>
<p>Todo: update httpd.conf with new options from httpd.conf.rpmnew</p>
<p>Start services</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>sudo /sbin/service httpd start
<span class="nv">$ </span>sudo /sbin/service nagios start
<span class="nv">$ </span>sudo /sbin/service nsca start
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/header.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Upgrading of Nagios</a><ul>
<li><a class="reference internal" href="#current-versions">Current versions</a></li>
<li><a class="reference internal" href="#upgrade-from-3-2-3-to-3-5-0">Upgrade from 3.2.3 to 3.5.0</a><ul>
<li><a class="reference internal" href="#install-update">Install update</a></li>
<li><a class="reference internal" href="#update-config-files">Update config files</a></li>
<li><a class="reference internal" href="#verify-config">Verify config</a></li>
<li><a class="reference internal" href="#fix-nagios-daemon">Fix Nagios Daemon</a></li>
<li><a class="reference internal" href="#start-services">Start services</a></li>
<li><a class="reference internal" href="#upgrade-apache-to-latest-2-2-x">Upgrade Apache to latest 2.2.x</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="neckar.html"
                        title="previous chapter">Installation of Neckar</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="typo3.html"
                        title="next chapter">Upgrading of TYPO3</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/nagios.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="typo3.html" title="Upgrading of TYPO3"
             >next</a></li>
        <li class="right" >
          <a href="neckar.html" title="Installation of Neckar"
             >previous</a> |</li>
        <li><a href="index.html">HiSPARC servers 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2013, HiSPARC.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>